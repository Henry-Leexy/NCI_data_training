

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Customise Pangeo Environment on Gadi &mdash; NCI data training  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> NCI data training
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../_overview/overview.html">Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_data/where_to_find_data.html">Where to Find Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_data/where_to_get_data.html">Where to Get Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_data/how_to_use_data.html">How to Use Data</a></li>
</ul>
<p class="caption"><span class="caption-text">How to run Jupyter notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install_jupyter.html">On your local machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_on_vdi.html">On the VDI</a></li>
<li class="toctree-l1"><a class="reference internal" href="pangeo.html">On Gadi</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples grouped by theme</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../climate/climate.html">Climate and Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eo/eo.html">Earth Observation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geophysics/geophysics.html">Geophysics</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples grouped by service type</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tds/tds.html">THREDDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gsky/gsky.html">GSKY</a></li>
</ul>
<p class="caption"><span class="caption-text">Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_help/help.html">Help</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NCI data training</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Customise Pangeo Environment on Gadi</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/_notebook/prep/Customise_Pangeo_environment_Gadi.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Customise-Pangeo-Environment-on-Gadi">
<h1>Customise Pangeo Environment on Gadi<a class="headerlink" href="#Customise-Pangeo-Environment-on-Gadi" title="Permalink to this headline">¶</a></h1>
<p>In this notebook we demonstrate how to</p>
<ul class="simple">
<li>load additional modules</li>
<li>install packages not available on Gadi</li>
</ul>
<p>Existing software list available on Gadi is <a class="reference external" href="https://opus.nci.org.au/x/6YT_Ag">here</a>. Users may need to load additional modules to run their own workflows. If a particular package is not available on Gadi, users can install it under their own working directory, e.g., their computer project space if it is allowed. Please note, the Pangeo environment should always be loaded <strong>before</strong> adding other modules or installing new modules.</p>
<div class="section" id="Step-1:-Enable-Pangeo-in-your-shell-envorinment">
<h2>Step 1: Enable Pangeo in your shell envorinment<a class="headerlink" href="#Step-1:-Enable-Pangeo-in-your-shell-envorinment" title="Permalink to this headline">¶</a></h2>
<p>To enable the Pangeo environment, you can use the following command within jobs, or within an interactive environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ module load pangeo
Loading pangeo/2020.05
  Loading requirement: intel-mkl/2019.3.199 python3/3.7.4 hdf5/1.10.5
    netcdf/4.7.3
</pre></div>
</div>
<p>Note that Pangeo has its own Python installation.</p>
</div>
<div class="section" id="Step-2:-Check-if-a-module-is-available-on-Gadi">
<h2>Step 2: Check if a module is available on Gadi<a class="headerlink" href="#Step-2:-Check-if-a-module-is-available-on-Gadi" title="Permalink to this headline">¶</a></h2>
<p>Lets see if <strong>tensorflow</strong> is available on Gadi.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[abc123@gadi-login-01 ~]$ module avail tensorflow

-----------------------/apps/Modules/modulefiles-----------------------
tensorflow/2.0.0
</pre></div>
</div>
</div>
<div class="section" id="Step-3a:-Load-modules-if-they-are-available-on-Gadi">
<h2>Step 3a: Load modules if they are available on Gadi<a class="headerlink" href="#Step-3a:-Load-modules-if-they-are-available-on-Gadi" title="Permalink to this headline">¶</a></h2>
<p>If the module exists, it will list all the versions available. Pick the one that you would like to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[abc123@gadi-login-01 ~]$ module load tensorflow/2.0.0
</pre></div>
</div>
<p>Check if the module has loaded properly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[abc123@gadi-login-01 ~]$ module list

Currently loaded Module files:
 1) pbs                    5) netcdf/4.7.3           9) nccl/2.5.6-1+cuda10.1
 2) intel-mkl/2019.3.199   6) pangeo/2020.05        10) openmpi/4.0.1
 3) python3/3.7.4          7) cuda/10.1             11) tensorflow/2.0.0
 4) hdf5/1.10.5            8) cudnn/7.6.5-cuda10.1
</pre></div>
</div>
</div>
<div class="section" id="Step-3b:-Install-modules-if-they-are-NOT-available-on-Gadi">
<h2>Step 3b: Install modules if they are NOT available on Gadi<a class="headerlink" href="#Step-3b:-Install-modules-if-they-are-NOT-available-on-Gadi" title="Permalink to this headline">¶</a></h2>
<p>Lets try the <strong>Deep Graph Library</strong> to see if it is available on Gadi. We can list all modules that start with the letter <strong>d</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[abc123@gadi-login-01 ~]$ module avail d

-----------------------/apps/Modules/modulefiles-----------------------
dalton/2018.2   dftbplus/19.1    dmo13/2018
</pre></div>
</div>
<p>We can see that the <strong>Deep Graph Library</strong> is not available as a module on Gadi and therefore we will need to install it ourselves.</p>
<p>There are multiple ways to install Python packages. For example, you could use the <strong>pip</strong> package manager which is a de facto standard package-management system used to install and manage software packages written in Python (see instruction here: <a class="reference external" href="https://packaging.python.org/tutorials/installing-packages/#installing-to-the-user-site">https://packaging.python.org/tutorials/installing-packages/#installing-to-the-user-site</a> ). Another popular way to install packages is through <a class="reference external" href="https://docs.conda.io/en/latest/">Conda</a> which is an open source package, dependency and environment
management system for any language - Python, R, Ruby, Jua, Scala, Java, JavaScript, C/C++, FORTRAN and many more.</p>
<p>Please note: Additional packages should be installed within a user’s own directory</p>
<p>As an example, you can use pip to install a package by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install --user &lt;package name&gt;
</pre></div>
</div>
<p>Let’s now install the <strong>Deep Graph Library</strong> using pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[abc123@gadi-login-01 ~]$ pip install --user deepgraph

Collecting deepgraph
  Using cached https://files.pythonhosted.org/packages/fc/3e/4a34a5316a5f886b8d7a6787c24852d9e5a5ef00b4ec6af0736f681a3a58/DeepGraph-0.2.2.tar.gz
Requirement already satisfied: numpy&gt;=1.6 in /apps/python3/3.7.4/lib/python3.7/site-packages/numpy-1.17.2-py3.7-linux-x86_64.egg (from deepgraph) (1.17.2)
Requirement already satisfied: pandas&gt;=0.17.0 in /apps/pangeo/2019.12/lib/python3.7/site-packages (from deepgraph) (0.25.3)
Requirement already satisfied: pytz&gt;=2017.2 in /apps/pangeo/2019.12/lib/python3.7/site-packages (from pandas&gt;=0.17.0-&gt;deepgraph) (2019.3)
Requirement already satisfied: python-dateutil&gt;=2.6.1 in /apps/python3/3.7.4/lib/python3.7/site-packages (from pandas&gt;=0.17.0-&gt;deepgraph) (2.8.1)
Requirement already satisfied: six&gt;=1.5 in /apps/python3/3.7.4/lib/python3.7/site-packages (from python-dateutil&gt;=2.6.1-&gt;pandas&gt;=0.17.0-&gt;deepgraph) (1.13.0)
Building wheels for collected packages: deepgraph
  Building wheel for deepgraph (setup.py) ... done
  Created wheel for deepgraph: filename=DeepGraph-0.2.2-cp37-cp37m-linux_x86_64.whl size=373893 sha256=53e6966cdd833e99af226dd925f9d9f1a10259053cd13f4391caa356bbfedabb
  Stored in directory: /home/900/nre900/.cache/pip/wheels/7f/4b/45/caf95420067f7a1795c5664bce0beda747d0ce931c2424c5ff
Successfully built deepgraph
Installing collected packages: deepgraph
Successfully installed deepgraph-0.2.2
</pre></div>
</div>
</div>
<div class="section" id="Step-4:-Validate-new-installation">
<h2>Step 4: Validate new installation<a class="headerlink" href="#Step-4:-Validate-new-installation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[abc123@gadi-login-01 ~]$ python

Python 3.7.4 (default, Nov  6 2019, 12:34:08)
[GCC 8.2.1 20180905 (Red Hat 8.2.1-3)] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.

&gt;&gt;&gt; import deepgraph
&gt;&gt;&gt; exit()
</pre></div>
</div>
</div>
<div class="section" id="Step-5:-Add-path-into-your-job-script">
<h2>Step 5: Add path into your job script<a class="headerlink" href="#Step-5:-Add-path-into-your-job-script" title="Permalink to this headline">¶</a></h2>
<p>If you want to use the program installed in your own space, you can add <code class="docutils literal notranslate"><span class="pre">export</span></code> into your login bash file:</p>
<p>export PYTHONPATH=&lt;<code class="docutils literal notranslate"><span class="pre">path</span> <span class="pre">to</span> <span class="pre">where</span> <span class="pre">you</span> <span class="pre">installed</span> <span class="pre">your</span> <span class="pre">own</span> <span class="pre">software</span></code>&gt;:$PYTHONPATH</p>
<p>You can also add into your job script run_ipynb_job.sh as below. Please replace the path to your own working space where you insalled the software.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
#PBS -N pangeo_test
#PBS -P c25
#PBS -q normal
#PBS -l walltime=5:00:00
#PBS -l ncpus=96
#PBS -l mem=384GB
#PBS -l jobfs=100GB
#PBS -l storage=scratch/z00+scratch/c25+gdata/c25
module load pangeo
export PYTHONPATH=/g/data/c25/apps:$PYTHONPATH
pangeo.ini.all.sh
sleep infinity
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, NCI

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>