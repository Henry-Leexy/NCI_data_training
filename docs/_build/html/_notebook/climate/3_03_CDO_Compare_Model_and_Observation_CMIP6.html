

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Use CDO to Compare Model and Observation Data &mdash; NCI data training  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> NCI data training
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../_overview/overview.html">Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_data/where_to_find_data.html">Where to Find Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_data/where_to_get_data.html">Where to Get Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_data/how_to_use_data.html">How to Use Data</a></li>
</ul>
<p class="caption"><span class="caption-text">How to run Jupyter notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prep/install_jupyter.html">On your local machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep/python_on_vdi.html">On the VDI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep/pangeo.html">On Gadi</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples grouped by theme</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="climate.html">Climate and Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eo/eo.html">Earth Observation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geophysics/geophysics.html">Geophysics</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples grouped by service type</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tds/tds.html">THREDDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gsky/gsky.html">GSKY</a></li>
</ul>
<p class="caption"><span class="caption-text">Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_help/help.html">Help</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NCI data training</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Use CDO to Compare Model and Observation Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/_notebook/climate/3_03_CDO_Compare_Model_and_Observation_CMIP6.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Use-CDO-to-Compare-Model-and-Observation-Data">
<h1>Use CDO to Compare Model and Observation Data<a class="headerlink" href="#Use-CDO-to-Compare-Model-and-Observation-Data" title="Permalink to this headline">¶</a></h1>
<p>In this notebook we demostrate how to compare model and observation data:</p>
<ul class="simple">
<li>Load CDO module</li>
<li>Look at the data information</li>
<li>Concatenate multiple files</li>
<li>Data remapping</li>
<li>Compare between model and obs data</li>
</ul>
<p>This example uses Coupled Model Intercomparison Project (CMIP6) collections. For more information, please visit <a class="reference external" href="https://geonetwork.nci.org.au/geonetwork/srv/eng/catalog.search#/metadata/f6600_2266_8675_3563">data catalogue</a> and <a class="reference external" href="https://pcmdi.llnl.gov/CMIP6/TermsOfUse/TermsOfUse6-1.html">terms of use</a>.</p>
<hr class="docutils" />
<ul class="simple">
<li>Authors: NCI Virtual Research Environment Team</li>
<li>Keywords: CMIP, CDO, concatenate data, data remapping</li>
<li>Create Date: 2019-Oct; Update Date: 2020-Apr</li>
</ul>
<div class="section" id="prerequisite">
<h2>prerequisite<a class="headerlink" href="#prerequisite" title="Permalink to this headline">¶</a></h2>
<p>To run this notebook on Gadi/VDI, the following module is needed:</p>
<ul class="simple">
<li>CDO</li>
</ul>
<p>You also need to be a member of the following data project to access the data: * oi10</p>
<p>You can request to join the project through <a class="reference external" href="https://my.nci.org.au">NCI’s user account management system</a>.</p>
<div class="section" id="What-is-CDO?">
<h3>What is CDO?<a class="headerlink" href="#What-is-CDO?" title="Permalink to this headline">¶</a></h3>
<p>CDO stands for “Climate Data Operators”. CDO is a collection of command line Operators to manipulate and analyse Climate and NWP model Data. It support data formats: GRIB 1/2, netCDF 3/4, SERVICE, EXTRA and IEG. There are more than 600 operators available. See <a class="reference external" href="https://code.mpimet.mpg.de/projects/cdo">CDO’s homepage</a> for more information about this library.</p>
</div>
</div>
<div class="section" id="Load-CDO-module">
<h2>Load CDO module<a class="headerlink" href="#Load-CDO-module" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ module load cdo
</pre></div>
</div>
</div>
<div class="section" id="check-data">
<h2>check data<a class="headerlink" href="#check-data" title="Permalink to this headline">¶</a></h2>
<p>Let’s look at the near surface temperature from the 20th century all-forcing historical simulation based on CESM2.0 model of NCAR</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls /g/data/oi10/replicas/CMIP6/CMIP/NCAR/CESM2/historical/r1i1p1f1/Amon/tas/gn/v20190308/tas_Amon_CESM2_historical_r1i1p1f1_gn_185001-201412.nc
</pre></div>
</div>
</div>
<div class="section" id="Have-a-look-at-the-data-file-using-cdo-info">
<h2>Have a look at the data file using cdo info<a class="headerlink" href="#Have-a-look-at-the-data-file-using-cdo-info" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>Basic usage:</strong></div>
<div class="line">cdo info | less</div>
</div>
<p><strong>less</strong> display only one page at a time in the termial. You can move forwards and backwards to see more. Press <strong>q</strong> to quit the view.</p>
</div>
<div class="section" id="Use-ncview-to-show-the-data">
<h2>Use <strong>ncview</strong> to show the data<a class="headerlink" href="#Use-ncview-to-show-the-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ncview /g/data/oi10/replicas/CMIP6/CMIP/NCAR/CESM2/historical/r1i1p1f1/Amon/tas/gn/v20190308/tas_Amon_CESM2_historical_r1i1p1f1_gn_185001-201412.nc
</pre></div>
</div>
<p><img alt="1" src="../../_images/cdo_anomoly_nino3.png" /></p>
</div>
<div class="section" id="Let’s-see-which-year-this-file-includes">
<h2>Let’s see which year this file includes<a class="headerlink" href="#Let’s-see-which-year-this-file-includes" title="Permalink to this headline">¶</a></h2>
<p>We use function <strong>showyear</strong> to display all the years in this file</p>
<div class="line-block">
<div class="line"><strong>Basic usage:</strong></div>
<div class="line">cdo showyear &lt;file.nc&gt;</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cdo showyear /g/data/oi10/replicas/CMIP6/CMIP/NCAR/CESM2/historical/r1i1p1f1/Amon/tas/gn/v20190308/tas_Amon_CESM2_historical_r1i1p1f1_gn_185001-201412.nc
</pre></div>
</div>
<p><img alt="2" src="../../_images/cdo_anomoly_nino2.png" /></p>
</div>
<div class="section" id="Select-only-10-year-data-from-the-original-model-file">
<h2>Select only 10 year data from the original model file<a class="headerlink" href="#Select-only-10-year-data-from-the-original-model-file" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>basic usage</strong>:</div>
<div class="line">cdo selyear, stratyear/endyear &lt;input.nc&gt; &lt;output.nc&gt;</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cdo selyear,1991/2000 /g/data/oi10/replicas/CMIP6/CMIP/NCAR/CESM2/historical/r1i1p1f1/Amon/tas/gn/v20190308/tas_Amon_CESM2_historical_r1i1p1f1_gn_185001-201412.nc  tas_Amon_CESM2_historical_r1i1p1f1_gn_199101-200012.nc
</pre></div>
</div>
</div>
<div class="section" id="show-the-attributes-of-the-data">
<h2>show the attributes of the data<a class="headerlink" href="#show-the-attributes-of-the-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cdo showatts tas_Amon_CESM2_historical_r1i1p1f1_gn_199101-200012.nc
</pre></div>
</div>
<p><img alt="image0" src="../../_images/cdo_comp3.png" /></p>
<p>The unit of temperature is ‘K’–Kelvin. We can convert the unit to Celsius in order to be consistent with observation data. First, substract 273.15 from data value, Second, change attribution units.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cdo setattribute,tas@units=degC -subc,273.15 tas_Amon_CESM2_historical_r1i1p1f1_gn_199101-200012.nc tas_Amon_CESM2_historical_r1i1p1f1_gn_199101-200012_unitC.nc
</pre></div>
</div>
</div>
<div class="section" id="Find-observational-temperature-data-and-select-year-1991-2000">
<h2>Find observational temperature data and select year 1991-2000<a class="headerlink" href="#Find-observational-temperature-data-and-select-year-1991-2000" title="Permalink to this headline">¶</a></h2>
<p>Delaware data :<a class="reference external" href="https://climatedataguide.ucar.edu/climate-data/global-land-precipitation-and-temperature-willmott-matsuura-university-delaware">https://climatedataguide.ucar.edu/climate-data/global-land-precipitation-and-temperature-willmott-matsuura-university-delaware</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls /scratch/public/nci-data-training/air.mon.mean.v501.nc
$ cdo selyear,1991/2000 /scratch/public/nci-data-training/air.mon.mean.v501.nc   air.mon.mean.v501.199101-200012.nc
</pre></div>
</div>
</div>
<div class="section" id="Now-we-want-to-see-the-difference-between-the-model-data-and-observation-data">
<h2>Now we want to see the difference between the model data and observation data<a class="headerlink" href="#Now-we-want-to-see-the-difference-between-the-model-data-and-observation-data" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>Basic usage:</strong></div>
<div class="line">cdo sub &lt;input1.nc&gt; &lt;input2.nc&gt; &lt;output.nc&gt; —substract input2.nc from input1.nc with the results being output.nc</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cdo sub tas_Amon_CESM2_historical_r1i1p1f1_gn_199101-200012.nc HADCRU_tas_1991_2000.nc CESM2_HADCRU_dif.nc
</pre></div>
</div>
<p>But got error info as below:</p>
<p>cdo sub(Abort): Grid size of the input parameter tas do not match!</p>
<p>This is because the resolution of the model data is different from that of the observation data. CDO provides several ways of data interpolation, one of which being ‘cdo remapcon’.</p>
<p><strong>basic usage:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cdo</span> <span class="n">remapcon</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">input1</span><span class="o">.</span><span class="n">nc</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">input2</span><span class="o">.</span><span class="n">nc</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">output</span><span class="o">.</span><span class="n">nc</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Here input1.nc is the file that we want the resolution to be consistent with. So, let’s do remapping first and then subtraction.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cdo sub -remapcon,air.mon.mean.v501.199101-200012.nc tas_Amon_CESM2_historical_r1i1p1f1_gn_199101-200012_unitC.nc air.mon.mean.v501.199101-200012.nc CESM2_DelawareT_dif.nc
</pre></div>
</div>
<p><img alt="image0" src="../../_images/cdo_comp3.png" /></p>
</div>
<div class="section" id="Calculate-average-difference-and-show-it-in-ncview">
<h2>Calculate average difference and show it in ncview<a class="headerlink" href="#Calculate-average-difference-and-show-it-in-ncview" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cdo timavg CESM2_DelawareT_dif.nc CESM2_DelawareT_dif_avg.nc
$ ncview CESM2_DelawareT_dif_avg.nc
</pre></div>
</div>
<div class="admonition note">
Tip: In CDO, an artificial distinction is made between the notions mean (e.g.timmean) and average (e.g.&nbsp;timavg). The mean is regarded as a statistical function, whereas the average is found simply by adding the sample members and dividing the result by the sample size. For example, the mean of 1, 2, miss and 3 is (1 + 2 + 3)/3 = 2, whereas the average is (1 + 2 + miss + 3)/4 = miss/4 = miss. If there are no missing values in the sample, the average and mean are identical.</div>
<p><img alt="image0" src="../../_images/cdo_comp3.png" /></p>
<p>We can see that in some areas the model simulated temperature is higher than the observation data, whereas other areas lower than the observation, and the difference seems to be higher in the high latitude areas.</p>
</div>
<div class="section" id="Summary">
<h2>Summary<a class="headerlink" href="#Summary" title="Permalink to this headline">¶</a></h2>
<p>In this example, we show how to use cdo to concatenate data files and remap data in order to change its resolution.</p>
<div class="section" id="Reference">
<h3>Reference<a class="headerlink" href="#Reference" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://code.mpimet.mpg.de/projects/cdo/embedded/cdo.pdf">https://code.mpimet.mpg.de/projects/cdo/embedded/cdo.pdf</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, NCI

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>